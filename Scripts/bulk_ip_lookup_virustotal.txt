import requests
import os


# Replace 'YOUR_API_KEY' with your actual VirusTotal API key
API_KEY = ''

def query_virustotal(ip):
    url = f'https://www.virustotal.com/api/v3/ip_addresses/{ip}'
    headers = {'x-apikey': API_KEY}
    response = requests.get(url, headers=headers)
    return response.json()

def read_ip_list(file_path):
    with open(file_path, 'r') as file:
        return [line.strip() for line in file]
    
def main():
    ip_list = read_ip_list('C:\\PATHOFYOURTEXTFILE')  # Replace with your file path
    results = {}
    malicious_ips = []  # List to store IPs with malicious activity

    for ip in ip_list:
        print(f'Querying {ip}...')
        result = query_virustotal(ip)
        results[ip] = result

        # Check if 'malicious' field is greater than zero
        malicious_count = result.get('data', {}).get('attributes', {}).get('last_analysis_stats', {}).get('malicious', 0)
        if malicious_count > 0:
            malicious_ips.append(ip)  # Add the IP to the malicious_ips list

    # Print the IPs with malicious activity
    print("IPs with malicious activity:")
    for ip in malicious_ips:
        print(ip)

if __name__ == '__main__':
    main()